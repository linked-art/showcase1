<html>
	<head>
		<link rel="stylesheet" href="/static/codemirror.css">
		<script src="/static/codemirror.js"></script>
		<script
		  src="https://code.jquery.com/jquery-3.5.1.min.js"
		  integrity="sha256-9/aliU8dGd2tb6OSsuzixeV4y/faTqgFtohetphbbj0="
		  crossorigin="anonymous"></script>
		<script src="https://cdn.jsdelivr.net/npm/mermaid@8.5.2/dist/mermaid.min.js"></script>
		<style>
#mermaid {
  background: white;
  border: 1px dashed black;
  text-align: center;
}

svg {
  background: white;
}

svg .node {
	font-size: 14px;
	line-height: 18px;
 	font-stretch: normal;
 	padding-right: 6px;
}

svg .edgeLabel {
	font-size: 14px;
	line-height: 18px;
 	font-stretch: normal;
 	background: white;
}

span.edgeLabel {
	padding-left: 2px;
	padding-right: 10px;

}
		</style>
	</head>
	<body>
		<b>Cromulent Linked Art Diagrammer</b>
		<script>
var editor = CodeMirror(document.body, {
  lineNumbers: true,
  mode: "python",
  value: "top = model.HumanMadeObject();"
});

doc = editor.getDoc();
editor.on("keyHandled", function(a,b) {
  	if (b == "Enter") {
		val = doc.getValue();
    	httpRequest = new XMLHttpRequest();
    	httpRequest.onreadystatechange = function() {
		    if (httpRequest.readyState === XMLHttpRequest.DONE) {
		      if (httpRequest.status === 200) {
		      	// Update the mermaid diagram
				e = document.getElementById("mermaid_wrapper");
				var text = httpRequest.responseText;
				$('#error').empty();
				if (text.startsWith('graph ')) {
					mermaid.mermaidAPI.render("mermaid", text, 
						function(svg, bnd) {
							e.innerHTML = svg;
						});
				} else {
					$('#error').append(text);
				}
		      } else {
		        alert('There was a problem with the request.');
		      }
		    }
    	}
    	httpRequest.open('POST', '/', true);
    	httpRequest.send(val);
	}
});

mermaid.initialize({
  startOnLoad: false,    
  theme: 'neutral',
  flowchart: { curve: 'basis' }
});
		</script>
<br/>

<div id="error" style="color: red"> </div>
<br/>

<div id="mermaid_wrapper" width="100%">
<div class="mermaid" id="mermaid" width="100%">
</div>
</div>

	</body>
</html>